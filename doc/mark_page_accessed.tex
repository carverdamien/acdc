\documentclass{article}
\usepackage{pgf}
\usepackage{tikz}
\usetikzlibrary{arrows,automata}
\usepackage[latin1]{inputenc}
\usepackage{listings}
\lstdefinestyle{customc}{
  belowcaptionskip=1\baselineskip,
  breaklines=true,
  frame=L,
  xleftmargin=\parindent,
  language=C,
  showstringspaces=false,
  basicstyle=\footnotesize\ttfamily,
  keywordstyle=\bfseries\color{green!40!black},
  commentstyle=\itshape\color{purple!40!black},
  identifierstyle=\color{blue},
  stringstyle=\color{orange},
}
\lstset{escapechar=@,style=customc}
\begin{document}
\begin{tikzpicture}[->,>=stealth',shorten >=1pt,auto,node distance=4cm,
                    semithick]
  \tikzstyle{every state}=[rectangle,draw,align=left]

  \node[state] (IU)               {Inactive \\ Unreferenced};
  \node[state] (IR) [right of=IU] {Inactive \\ Referenced};
  \node[state] (AU) [below of=IR] {Active \\ Unreferenced};
  \node[state] (AR) [below of=IU] {Active \\ Referenced};
  \node[state] (IL) [above of=IU] {Idle};
  \node[state] (NI) [right of=IL] {Not idle};

  \path (IU) edge              node {} (IR)
  		  (IR) edge              node {} (AU)
  		  (AU) edge              node {} (AR)
  		  (AR) edge [loop below] node {} (AR)
  		  (IL) edge              node {} (NI)
  		  (NI) edge [loop above] node {} (NI);

\end{tikzpicture}
\lstinputlisting[caption=mark\_page\_accessed, style=customc]{src/mark_page_accessed.c}
\end{document}